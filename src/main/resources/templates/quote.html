<!doctype html>
<html xmlns:th="http://www.thymeleaf.org" lang="ru">
<head>
    <meta charset="utf-8"/>
    <title>Quote</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
          integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY=" crossorigin=""/>
    <style>#map {
        height: 520px;
    }
     .leaflet-control-attribution {
       display: none !important;
    }
     a.back {
        display: inline-block;
        padding: 10px 15px;
        margin: 5px;
        background-color: #007bff;
        color: white;
        text-decoration: none;
        border-radius: 5px;
         align-self: center;
    }
    a.back:hover {
        background-color: #0056b3;
    }
    </style>
</head>
<body><h2>Итоги</h2>
<div th:if="${quote != null}"><p> Total: <b th:text="${#numbers.formatDecimal(quote.totalCostUsd,  1, 2, 'COMMA')}"></b>
    USD | Transport: <span th:text="${#numbers.formatDecimal(quote.transportCostUsd, 1, 2, 'COMMA')}"></span> USD |
    Customs: <span th:text="${#numbers.formatDecimal(quote.customsCostUsd, 1, 2, 'COMMA')}"></span> USD | Eco: <span
            th:text="${#numbers.formatDecimal(quote.ecoFeesUsd, 1, 2, 'COMMA')}"></span> USD | Hours: <span
            th:text="${#numbers.formatDecimal(quote.totalHours,  1, 2, 'COMMA')}"></span> h </p></div>
<div id="map"></div>
<table border="1" th:if="${quote != null}">
    <thead>
    <tr>
        <th>#</th>
        <th>Mode</th>
        <th>From</th>
        <th>To</th>
        <th>Km</th>
        <th>Hours</th>
    </tr>
    </thead>
    <tbody>
    <tr th:each="s, i : ${quote.segments}">
        <td th:text="${i.index + 1}"></td>
        <td th:text="${s.mode}"></td>
        <td th:text="${s.originCode}"></td>
        <td th:text="${s.destinationCode}"></td>
        <td th:text="${#numbers.formatDecimal(s.distanceKm, 1, 2, 'COMMA')}"></td>
        <td th:text="${#numbers.formatDecimal(s.hours,  1, 2, 'COMMA')}"></td>
    </tr>
    </tbody>
</table>
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
        integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo=" crossorigin=""></script>
<script th:inline="javascript"> /*<![CDATA[*/
var map = L.map('map').setView([20, 0], 2);
L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
    maxZoom: 19,
    attribution: '&copy; OpenStreetMap'
}).addTo(map); /* GeoJSON линий из сегментов */
var segs = /*[[${quote.segments}]]*/ [];
var group = L.featureGroup();
segs.forEach(function (s) {
    if (s.geoJson) {
        var g = JSON.parse(s.geoJson);
        var layer = L.geoJSON(g).addTo(map);
        group.addLayer(layer);
    }
});
if (group.getLayers().length > 0) {
    map.fitBounds(group.getBounds(), {padding: [20, 20]});
} /*]]>*/ </script>


<a class="back" th:href="@{/}">⬅ Back  </a>
</body>
</html>